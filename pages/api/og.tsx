import { ImageResponse } from "@vercel/og";

export const config = {
    runtime: "edge",
};

export default function handler(req) {
    try {
        const { searchParams } = new URL(req.url);

        const title = searchParams.has("title")
            ? searchParams.get("title")?.slice(0, 100)
            : "Hello World";
        const date = searchParams.get("date") || "1970-01-01";
        const time = searchParams.get("time") || "0 min read"
        const titleSize = title.length > 15 ? (-5 * title.length + 175) : 100;
        let topText = "";
        if (!date.includes("Invalid")) {
            topText = date + " â€¢ " + time;
        }
        
        return new ImageResponse(
            (
                <div
                    style={{
                        display: "flex",
                        paddingLeft: "5rem",
                        paddingRight: "5rem",
                        paddingTop: "3rem",
                        flexDirection: "column",
                        backgroundColor: "#1e293b",
                        width: "1200",
                        height: "630",
                        fontSize: "30",
                    }}
                >
                    <p style={{ color: "#6B7280", fontWeight: "600" }}>
                        {topText}
                    </p>
                    <p
                        style={{
                            marginBottom: "60",
                            marginTop: "-10",
                            fontSize: String(titleSize),
                            fontWeight: "800",
                            color: "#e2e8f0",
                        }}
                    >
                        {title}
                    </p>
                    <div
                        style={{
                            display: "flex",
                            flexDirection: "column",
                            gap: "-20",
                        }}
                    >
                        <div style={{ display: "flex" }}>
                            <svg
                                style={{
                                    marginRight: "0.5rem",
                                    marginTop: "1.9rem",
                                    width: "2.5rem",
                                    height: "2.5rem",
                                }}
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                                fill="#FFF"
                            >
                                <path d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z" />
                            </svg>
                            <p style={{ fontWeight: "700", color: "#e2e8f0" }}>
                                @uncenter
                            </p>
                        </div>
                        <div style={{ display: "flex" }}>
                            <svg
                                style={{
                                    marginRight: "0.5rem",
                                    marginTop: "1.7rem",
                                    width: "2.5rem",
                                    height: "2.5rem",
                                }}
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    fill="#67e8f9"
                                    d="M16.36,14C16.44,13.34 16.5,12.68 16.5,12C16.5,11.32 16.44,10.66 16.36,10H19.74C19.9,10.64 20,11.31 20,12C20,12.69 19.9,13.36 19.74,14M14.59,19.56C15.19,18.45 15.65,17.25 15.97,16H18.92C17.96,17.65 16.43,18.93 14.59,19.56M14.34,14H9.66C9.56,13.34 9.5,12.68 9.5,12C9.5,11.32 9.56,10.65 9.66,10H14.34C14.43,10.65 14.5,11.32 14.5,12C14.5,12.68 14.43,13.34 14.34,14M12,19.96C11.17,18.76 10.5,17.43 10.09,16H13.91C13.5,17.43 12.83,18.76 12,19.96M8,8H5.08C6.03,6.34 7.57,5.06 9.4,4.44C8.8,5.55 8.35,6.75 8,8M5.08,16H8C8.35,17.25 8.8,18.45 9.4,19.56C7.57,18.93 6.03,17.65 5.08,16M4.26,14C4.1,13.36 4,12.69 4,12C4,11.31 4.1,10.64 4.26,10H7.64C7.56,10.66 7.5,11.32 7.5,12C7.5,12.68 7.56,13.34 7.64,14M12,4.03C12.83,5.23 13.5,6.57 13.91,8H10.09C10.5,6.57 11.17,5.23 12,4.03M18.92,8H15.97C15.65,6.75 15.19,5.55 14.59,4.44C16.43,5.07 17.96,6.34 18.92,8M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"
                                />
                            </svg>
                            <p
                                style={{
                                    letterSpacing: "-0.025em",
                                    color: "#67e8f9",
                                }}
                            >
                                https://uncenter.org
                            </p>
                        </div>
                        <div style={{ display: "flex" }}>
                            <svg
                                style={{
                                    marginRight: "0.5rem",
                                    marginTop: "2rem",
                                    width: "2.5rem",
                                    height: "2.5rem",
                                }}
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    fill="#C4B5FD"
                                    d="M20.94,14C20.66,15.41 18.5,16.96 15.97,17.26C14.66,17.41 13.37,17.56 12,17.5C9.75,17.39 8,16.96 8,16.96V17.58C8.32,19.8 10.22,19.93 12.03,20C13.85,20.05 15.47,19.54 15.47,19.54L15.55,21.19C15.55,21.19 14.27,21.87 12,22C10.75,22.07 9.19,21.97 7.38,21.5C3.46,20.45 2.78,16.26 2.68,12L2.67,8.57C2.67,4.23 5.5,2.96 5.5,2.96C6.95,2.3 9.41,2 11.97,2H12.03C14.59,2 17.05,2.3 18.5,2.96C18.5,2.96 21.33,4.23 21.33,8.57C21.33,8.57 21.37,11.78 20.94,14M18,8.91C18,7.83 17.7,7 17.15,6.35C16.59,5.72 15.85,5.39 14.92,5.39C13.86,5.39 13.05,5.8 12.5,6.62L12,7.5L11.5,6.62C10.94,5.8 10.14,5.39 9.07,5.39C8.15,5.39 7.41,5.72 6.84,6.35C6.29,7 6,7.83 6,8.91V14.17H8.1V9.06C8.1,8 8.55,7.44 9.46,7.44C10.46,7.44 10.96,8.09 10.96,9.37V12.16H13.03V9.37C13.03,8.09 13.53,7.44 14.54,7.44C15.44,7.44 15.89,8 15.89,9.06V14.17H18V8.91Z"
                                />
                            </svg>
                            <p
                                style={{
                                    color: "#C4B5FD",
                                    letterSpacing: "-0.025em",
                                }}
                            >
                                @uncenter@fosstodon.org
                            </p>
                        </div>
                    </div>
                    <svg
                        style={{
                            position: "absolute",
                            right: "100",
                            bottom: "18",
                            width: "15rem",
                            height: "15rem",
                        }}
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 512 512"
                    >
                        <path
                            fill="#1d1e1e"
                            d="M453.166 9.634v255.394c0 5.271-4.363 9.634-9.634 9.634H68.469c-5.272 0-9.634-4.363-9.634-9.634V9.634C58.835 4.302 63.197 0 68.469 0h375.063c5.271 0 9.634 4.302 9.634 9.634z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#9f9e9f"
                            d="M231.454 60.185v-.013h-.003z"
                            transform="translate(0 112)"
                        />
                        <path
                            style={{ opacity: 0.3 }}
                            fill="#f4f4f5"
                            d="m232.25 63.523-.796-3.338v3.338z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#282828"
                            d="M435.973 30.841v219.851c0 7.167-5.878 13.004-13.094 13.004H86.623c-.99 0-1.921-.115-2.852-.347-5.877-1.271-10.242-6.473-10.242-12.657V30.841c0-7.166 5.877-13.004 13.094-13.004h336.256c7.216 0 13.094 5.837 13.094 13.004z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#333"
                            d="M378.126 17.837 130.968 263.349h-55.17c-1.222 0-2.269-1.04-2.269-2.312V30.841c0-7.166 5.877-13.004 13.094-13.004z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#c8c7c7"
                            d="m512 252.728-.788 2.848-3.393 11.997c0 3.938-4.726 7.089-10.543 7.089H14.724c-5.817 0-10.543-3.151-10.543-7.089l-2.666-9.392-1.454-5.211-.061-.242Z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#666767"
                            d="M329.112 252.733a7.071 7.071 0 0 1-7.071 7.071H189.959a7.071 7.071 0 0 1-7.071-7.071z"
                            transform="translate(0 112)"
                        />
                        <path
                            style={{ opacity: 0.5 }}
                            fill="#f4f4f5"
                            d="M512 252.728v2.848H330.952c0 3.878-4.847 7.029-10.846 7.029H191.894c-5.999 0-10.846-3.151-10.846-7.029H0v-2.848h182.866c0 .616.204 1.165.352 1.733 1.154 3.085 5.273 5.356 10.252 5.356h125.061c4.979 0 9.098-2.271 10.251-5.356.147-.569.352-1.117.352-1.733z"
                            transform="translate(0 112)"
                        />
                        <path
                            style={{ opacity: 0.1 }}
                            fill="#fff"
                            d="m268.967 252.728-8.362 7.089-3.332 2.787-4.241 3.575-9.997 8.483H14.724c-5.817 0-10.543-3.151-10.543-7.089l-2.666-9.392-1.454-5.211-.061-.242Z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#d18770"
                            style={{ strokeWidth: 0.318594 }}
                            d="M202.909 104.545c.03-2.216-1.826-8.037.962-12.8 2.786-4.763-14.66-6.007-23.497.108-8.51 5.887.612 10.954 6.227 9.84 11.379-2.26 16.25 7.34 16.308 2.852z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#dd8968"
                            style={{ strokeWidth: 0.318594 }}
                            d="M196.955 77.968c.027 2.215-1.826 8.035.96 12.8 2.785 4.76-16.248 7.34-23.495-.109-7.248-7.45.611-10.952 6.229-9.838 11.371 2.257 16.244-7.342 16.306-2.853z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#74acf6"
                            style={{ fillOpacity: 1, strokeWidth: 0.318594 }}
                            d="M198.043 127.145c6.313-6.258 11.489-9.074 7.229-14.745-8.125-6.844-11.911-14.25-11.911-24.693 0-10.44 5.025-19.891 13.149-26.733 8.125-6.842 19.346-11.076 31.745-11.076 12.4 0 23.62 4.234 31.746 11.076 8.125 6.842 13.148 16.293 13.148 26.733 0 15.434-14.658 27.779-14.658 35.494-.917 3.088 5.497 6.947 13.741 6.947 8.25 0 35.735 5.4 55.89-16.976 5.305-6.175 11.72-2.7 10.997 6.171-.693 8.503-6.416 80.248-66.887 80.248h-48.56c-13.912 0-26.51-4.75-35.629-12.43-9.121-7.68-14.762-18.288-14.762-30.01 0-11.717 5.64-22.327 14.762-30.006"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#fff"
                            style={{ strokeWidth: 0.288134 }}
                            d="M220.333 81.11c0 4.903-3.86 8.876-8.618 8.876-4.76 0-8.62-3.973-8.62-8.876 0-4.897 3.86-8.872 8.62-8.872 4.757 0 8.618 3.975 8.618 8.872z"
                            transform="translate(0 112)"
                        />
                        <path
                            fill="#646363"
                            style={{ fillOpacity: 1, strokeWidth: 1.17382 }}
                            d="M216.942 81.374a5.283 5.846 0 0 1-5.27 5.845 5.283 5.846 0 0 1-5.295-5.818 5.283 5.846 0 0 1 5.245-5.873 5.283 5.846 0 0 1 5.32 5.791"
                            transform="translate(0 112)"
                        />
                    </svg>
                </div>
            ),
            {
                width: 1200,
                height: 630,
            }
        );
    } catch (e) {
        console.log(`${e.message}`);
        return new Response(`Failed to generate the image`, {
            status: 500,
        });
    }
}
